<!DOCTYPE html>
<html>

<head>
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css' rel='stylesheet' />
    <style>
        #map {
            width: 100%;
            height: 90vh;
        }
    </style>
</head>

<body>
    <a style="color: blue;" href="./solicitar-entrega.html">Retornar</a>
    <form>
        <input class="address" list="address" placeholder="Ponto de Partida" type="text"/>
        <div class="suggestions">
            <ul class="suggestions-options"></ul>
        </div>
        <input class="address" list="address" placeholder="Ponto de Chegada" type="text"/>
        <div class="suggestions">
            <ul class="suggestions-options"></ul>
        </div>
        <button type="button">Buscar</button>
    </form>

    <div id="map"></div>

    <script>
        const input = document.querySelectorAll('.address')
        const results = document.querySelectorAll('.suggestions-options')
        const accessToken = 'pk.eyJ1IjoiZ2FicmllbGNhcnZhbGgwIiwiYSI6ImNsa3JvOW55eDJscXgzcWtlY2F5d21kZW4ifQ.Xp_C-dMh7SEjIBFKd8njCA'

        mapboxgl.accessToken = accessToken
        const map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/streets-v12',
            center: [-46.625290, -23.533773],
            zoom: 12,
            language: 'pt'
        })

        input.forEach((item, i) => {
            item.addEventListener('input', async () => {
                const url = `https://api.mapbox.com/geocoding/v5/mapbox.places/${item.value}.json?access_token=${accessToken}&language=pt`
                const res = await fetch(url)
                const dataRes = await res.json()
                console.log(dataRes)
                results[i].innerHTML = ''
                dataRes.features.forEach((item) => {
                    const suggestion = document.createElement('li')
                    suggestion.innerText = item.place_name
                    suggestion.addEventListener('click', () => {
                        const coords = item.geometry.coordinates
                        const marker = new mapboxgl.Marker({
                            color: '#ef9652',
                            draggable: true
                        }).setLngLat(coords).addTo(map)
                        // console.log(item.geometry.coordinates)
                        map.flyTo({
                            center: coords,
                            zoom: 12
                        })
                    })
                    results[i].appendChild(suggestion)
                })
            })
        })
    </script>
</body>

</html>